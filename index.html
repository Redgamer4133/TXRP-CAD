<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TXRP CAD System - Full Portal</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            color: #333;
        }

        /* Login Page */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .login-box {
            background: white;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            width: 100%;
            max-width: 400px;
        }

        .login-box h1 {
            text-align: center;
            color: #1e3c72;
            margin-bottom: 10px;
        }

        .login-box p {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
        }

        .login-type-selector {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }

        .login-type-btn {
            padding: 15px;
            border: 2px solid #ddd;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .login-type-btn:hover {
            border-color: #2a5298;
            background: #f8f9fa;
        }

        .login-type-btn.active {
            border-color: #2a5298;
            background: #2a5298;
            color: white;
        }

        .login-type-btn h3 {
            font-size: 16px;
            margin-bottom: 5px;
        }

        .login-type-btn p {
            font-size: 12px;
            margin: 0;
            opacity: 0.8;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-weight: 500;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            transition: border 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #2a5298;
        }

        .btn {
            width: 100%;
            padding: 12px;
            background: #2a5298;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .btn:hover {
            background: #1e3c72;
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-danger {
            background: #dc3545;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .btn-success {
            background: #28a745;
        }

        .btn-success:hover {
            background: #218838;
        }

        .btn-warning {
            background: #ffc107;
            color: #333;
        }

        .btn-warning:hover {
            background: #e0a800;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
            width: auto;
            margin: 2px;
        }

        /* Dashboard */
        .dashboard {
            display: none;
        }

        .navbar {
            background: #1e3c72;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .navbar.civilian {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .navbar h2 {
            color: white;
            font-size: 24px;
        }

        .navbar .user-info {
            color: white;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logout-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .logout-btn:hover {
            background: #c82333;
        }

        .container {
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .tab-navigation {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 12px 24px;
            background: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
            font-weight: 500;
        }

        .tab-btn:hover {
            background: #e9ecef;
        }

        .tab-btn.active {
            background: #2a5298;
            color: white;
        }

        .tab-btn.active.civilian-theme {
            background: #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .card h3 {
            margin-bottom: 15px;
            color: #1e3c72;
            border-bottom: 2px solid #2a5298;
            padding-bottom: 10px;
        }

        .card.civilian-theme h3 {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .call-item,
        .unit-item,
        .bolo-item,
        .db-record,
        .info-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #2a5298;
            margin-bottom: 15px;
        }

        .info-card.civilian-theme {
            border-left-color: #667eea;
        }

        .call-item h4,
        .unit-item h4,
        .bolo-item h4,
        .db-record h4,
        .info-card h4 {
            color: #1e3c72;
            margin-bottom: 10px;
        }

        .call-item p,
        .unit-item p,
        .bolo-item p,
        .db-record p,
        .info-card p {
            margin: 5px 0;
            font-size: 14px;
        }

        .status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-top: 5px;
        }

        .status-available {
            background: #d4edda;
            color: #155724;
        }

        .status-busy {
            background: #fff3cd;
            color: #856404;
        }

        .status-offline {
            background: #f8d7da;
            color: #721c24;
        }

        .status-active {
            background: #d1ecf1;
            color: #0c5460;
        }

        .status-wanted {
            background: #f8d7da;
            color: #721c24;
        }

        .status-valid {
            background: #d4edda;
            color: #155724;
        }

        .status-stolen {
            background: #f8d7da;
            color: #721c24;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .status-paid {
            background: #d4edda;
            color: #155724;
        }

        .priority-high {
            border-left-color: #dc3545;
        }

        .priority-medium {
            border-left-color: #ffc107;
        }

        .priority-low {
            border-left-color: #28a745;
        }

        .search-result {
            background: #e9ecef;
            padding: 15px;
            border-radius: 5px;
            margin-top: 15px;
        }

        .search-result h4 {
            color: #1e3c72;
            margin-bottom: 10px;
        }

        .search-result p {
            margin: 5px 0;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #6c757d;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
            overflow-y: auto;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            margin: 20px;
        }

        .modal-content h3 {
            color: #1e3c72;
            margin-bottom: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        table th,
        table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #1e3c72;
        }

        table tr:hover {
            background: #f8f9fa;
        }

        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 3px;
            font-size: 11px;
            font-weight: 600;
            margin: 2px;
        }

        .badge-danger {
            background: #dc3545;
            color: white;
        }

        .badge-success {
            background: #28a745;
            color: white;
        }

        .badge-warning {
            background: #ffc107;
            color: #333;
        }

        .badge-info {
            background: #17a2b8;
            color: white;
        }

        .search-bar {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .search-bar input {
            flex: 1;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-card h4 {
            font-size: 32px;
            margin-bottom: 5px;
        }

        .stat-card p {
            opacity: 0.9;
            font-size: 14px;
        }

        .alert {
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 15px;
        }

        .alert-warning {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            color: #856404;
        }

        .alert-danger {
            background: #f8d7da;
            border-left: 4px solid #dc3545;
            color: #721c24;
        }

        .alert-success {
            background: #d4edda;
            border-left: 4px solid #28a745;
            color: #155724;
        }

        .alert-info {
            background: #d1ecf1;
            border-left: 4px solid #17a2b8;
            color: #0c5460;
        }

        .profile-header {
            display: flex;
            align-items: center;
            gap: 20px;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 8px;
            color: white;
            margin-bottom: 20px;
        }

        .profile-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
        }

        .profile-info h2 {
            margin-bottom: 5px;
        }

        .profile-info p {
            opacity: 0.9;
        }

        .service-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .service-card:hover {
            border-color: #667eea;
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .service-card .icon {
            font-size: 48px;
            margin-bottom: 10px;
        }

        .service-card h4 {
            color: #1e3c72;
            margin-bottom: 10px;
        }

        @media (max-width: 768px) {
            .navbar {
                flex-direction: column;
                gap: 10px;
            }

            .tab-navigation {
                flex-direction: column;
            }

            .grid {
                grid-template-columns: 1fr;
            }

            table {
                font-size: 12px;
            }

            table th,
            table td {
                padding: 8px;
            }

            .profile-header {
                flex-direction: column;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div id="loginPage" class="login-container">
        <div class="login-box">
            <h1>üöî TXRP Portal</h1>
            <p>Computer-Aided Dispatch & Civilian System</p>
            
            <div class="login-type-selector">
                <div class="login-type-btn active" onclick="selectLoginType('leo')">
                    <h3>üëÆ LEO Login</h3>
                    <p>Police, Fire, EMS</p>
                </div>
                <div class="login-type-btn" onclick="selectLoginType('civilian')">
                    <h3>üë§ Civilian</h3>
                    <p>Resident Access</p>
                </div>
            </div>

            <!-- LEO Login Form -->
            <form id="leoLoginForm">
                <div class="form-group">
                    <label for="username">Username</label>
                    <input type="text" id="username" required placeholder="Enter your username">
                </div>
                <div class="form-group">
                    <label for="callsign">Callsign</label>
                    <input type="text" id="callsign" required placeholder="e.g., 1-Adam-12">
                </div>
                <div class="form-group">
                    <label for="department">Department</label>
                    <select id="department" required>
                       <option value="">Select Department</option>
                        <option value="DPD">DPD</option>
                        <option value="TXSO">TXSO</option>
                        <option value="TXSP">TXSP</option>
                        <option value="FIRE">Fire Department</option>
                        <option value="EMS">Emergency Medical Services</option>
                        <option value="COMM">Communications/Dispatch</option>
                        <option value="Staff">Staff</option>
                        <option value="USMS">USMS</option>
                        <option value="DHS">DHS</option>
                    </select>
                </div>
                <button type="submit" class="btn">Sign In</button>
            </form>

            <!-- Civilian Login Form -->
            <form id="civilianLoginForm" style="display: none;">
                <div class="form-group">
                    <label for="civLoginFirstName">First Name</label>
                    <input type="text" id="civLoginFirstName" required placeholder="Enter your first name">
                </div>
                <div class="form-group">
                    <label for="civLoginLastName">Last Name</label>
                    <input type="text" id="civLoginLastName" required placeholder="Enter your last name">
                </div>
                <div class="form-group">
                    <label for="civLoginDOB">Date of Birth</label>
                    <input type="date" id="civLoginDOB" required>
                </div>
                <button type="submit" class="btn">Login</button>
                <button type="button" class="btn btn-secondary" onclick="openModal('civilianRegister')">Register New Account</button>
            </form>
        </div>
    </div>

    <!-- LEO Dashboard -->
    <div id="leoDashboard" class="dashboard">
        <nav class="navbar">
            <h2>üöî TXRP CAD System</h2>
            <div class="user-info">
                <span id="userDisplay"></span>
                <button class="logout-btn" onclick="logout()">Logout</button>
            </div>
        </nav>

        <div class="container">
            <div class="tab-navigation">
                <button class="tab-btn active" onclick="switchTab('overview')">üìä Overview</button>
                <button class="tab-btn" onclick="switchTab('calls')">üìû Active Calls</button>
                <button class="tab-btn" onclick="switchTab('units')">üöì Units</button>
                <button class="tab-btn" onclick="switchTab('lookup')">üîç Lookup</button>
                <button class="tab-btn" onclick="switchTab('bolo')">‚ö†Ô∏è BOLOs</button>
                <button class="tab-btn" onclick="switchTab('database')">üíæ Database</button>
            </div>

            <!-- Overview Tab -->
            <div id="overview" class="tab-content active">
                <div class="stats-grid">
                    <div class="stat-card">
                        <h4 id="statCalls">0</h4>
                        <p>Active Calls</p>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                        <h4 id="statUnits">0</h4>
                        <p>Units on Duty</p>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                        <h4 id="statCivilians">0</h4>
                        <p>Civilians in DB</p>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
                        <h4 id="statVehicles">0</h4>
                        <p>Vehicles in DB</p>
                    </div>
                </div>
                
                <div class="grid">
                    <div class="card">
                        <h3>Recent Calls</h3>
                        <div id="overviewCalls">
                            <div class="empty-state">No active calls</div>
                        </div>
                    </div>
                    <div class="card">
                        <h3>Active BOLOs</h3>
                        <div id="overviewBolos">
                            <div class="empty-state">No active BOLOs</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Calls Tab -->
            <div id="calls" class="tab-content">
                <div class="card">
                    <h3>üìû Call Management</h3>
                    <button class="btn btn-success" onclick="openModal('newCall')">Create New Call</button>
                    <div id="callsList" style="margin-top: 20px;">
                        <div class="empty-state">No active calls</div>
                    </div>
                </div>
            </div>

            <!-- Units Tab -->
            <div id="units" class="tab-content">
                <div class="card">
                    <h3>üöì Unit Management</h3>
                    <div class="grid" id="unitsList">
                        <div class="empty-state">No units on duty</div>
                    </div>
                </div>
            </div>

            <!-- Lookup Tab -->
            <div id="lookup" class="tab-content">
                <div class="card">
                    <h3>üîç Database Lookup</h3>
                    <div class="form-group">
                        <label>Search Type</label>
                        <select id="searchType">
                            <option value="person">Person</option>
                            <option value="vehicle">Vehicle</option>
                            <option value="weapon">Weapon</option>
                            <option value="property">Property</option>
                        </select>
                    </div>
                    <div class="search-bar">
                        <input type="text" id="searchQuery" placeholder="Enter name, plate, serial number...">
                        <button class="btn" style="width: auto;" onclick="performLookup()">Search</button>
                    </div>
                    <div id="searchResults"></div>
                </div>
            </div>

            <!-- BOLO Tab -->
            <div id="bolo" class="tab-content">
                <div class="card">
                    <h3>‚ö†Ô∏è Be On the Lookout</h3>
                    <button class="btn btn-success" onclick="openModal('newBolo')">Create BOLO</button>
                    <div id="boloList" style="margin-top: 20px;">
                        <div class="empty-state">No active BOLOs</div>
                    </div>
                </div>
            </div>

            <!-- Database Tab -->
            <div id="database" class="tab-content">
                <div class="card">
                    <h3>üíæ Database Management</h3>
                    
                    <div class="tab-navigation">
                        <button class="tab-btn active" onclick="switchDbTab('civilians')">üë§ Civilians</button>
                        <button class="tab-btn" onclick="switchDbTab('vehicles')">üöó Vehicles</button>
                        <button class="tab-btn" onclick="switchDbTab('warrants')">‚öñÔ∏è Warrants</button>
                        <button class="tab-btn" onclick="switchDbTab('citations')">üìù Citations</button>
                        <button class="tab-btn" onclick="switchDbTab('weapons')">üî´ Weapons</button>
                        <button class="tab-btn" onclick="switchDbTab('properties')">üè† Properties</button>
                    </div>

                    <!-- Civilians Database -->
                    <div id="db-civilians" class="db-tab active">
                        <button class="btn btn-success" style="margin: 20px 0; width: auto;" onclick="openModal('addCivilian')">‚ûï Add Civilian</button>
                        <button class="btn btn-warning" style="margin: 20px 10px; width: auto;" onclick="exportDatabase('civilians')">üì• Export</button>
                        <div id="civiliansTable"></div>
                    </div>

                    <!-- Vehicles Database -->
                    <div id="db-vehicles" class="db-tab" style="display: none;">
                        <button class="btn btn-success" style="margin: 20px 0; width: auto;" onclick="openModal('addVehicle')">‚ûï Add Vehicle</button>
                        <button class="btn btn-warning" style="margin: 20px 10px; width: auto;" onclick="exportDatabase('vehicles')">üì• Export</button>
                        <div id="vehiclesTable"></div>
                    </div>

                    <!-- Warrants Database -->
                    <div id="db-warrants" class="db-tab" style="display: none;">
                        <button class="btn btn-success" style="margin: 20px 0; width: auto;" onclick="openModal('addWarrant')">‚ûï Add Warrant</button>
                        <button class="btn btn-warning" style="margin: 20px 10px; width: auto;" onclick="exportDatabase('warrants')">üì• Export</button>
                        <div id="warrantsTable"></div>
                    </div>

                    <!-- Citations Database -->
                    <div id="db-citations" class="db-tab" style="display: none;">
                        <button class="btn btn-success" style="margin: 20px 0; width: auto;" onclick="openModal('addCitation')">‚ûï Add Citation</button>
                        <button class="btn btn-warning" style="margin: 20px 10px; width: auto;" onclick="exportDatabase('citations')">üì• Export</button>
                        <div id="citationsTable"></div>
                    </div>

                    <!-- Weapons Database -->
                    <div id="db-weapons" class="db-tab" style="display: none;">
                        <button class="btn btn-success" style="margin: 20px 0; width: auto;" onclick="openModal('addWeapon')">‚ûï Add Weapon</button>
                        <button class="btn btn-warning" style="margin: 20px 10px; width: auto;" onclick="exportDatabase('weapons')">üì• Export</button>
                        <div id="weaponsTable"></div>
                    </div>

                    <!-- Properties Database -->
                    <div id="db-properties" class="db-tab" style="display: none;">
                        <button class="btn btn-success" style="margin: 20px 0; width: auto;" onclick="openModal('addProperty')">‚ûï Add Property</button>
                        <button class="btn btn-warning" style="margin: 20px 10px; width: auto;" onclick="exportDatabase('properties')">üì• Export</button>
                        <div id="propertiesTable"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Civilian Dashboard -->
    <div id="civilianDashboard" class="dashboard">
        <nav class="navbar civilian">
            <h2>üë§ TXRP Civilian Portal</h2>
            <div class="user-info">
                <span id="civilianUserDisplay"></span>
                <button class="logout-btn" onclick="logout()">Logout</button>
            </div>
        </nav>

        <div class="container">
            <div class="tab-navigation">
                <button class="tab-btn active civilian-theme" onclick="switchCivTab('civHome')">üè† Home</button>
                <button class="tab-btn civilian-theme" onclick="switchCivTab('civProfile')">üë§ Profile</button>
                <button class="tab-btn civilian-theme" onclick="switchCivTab('civVehicles')">üöó My Vehicles</button>
                <button class="tab-btn civilian-theme" onclick="switchCivTab('civRecords')">üìã Records</button>
                <button class="tab-btn civilian-theme" onclick="switchCivTab('civServices')">üö® Services</button>
            </div>

            <!-- Civilian Home Tab -->
            <div id="civHome" class="tab-content active">
                <div class="profile-header">
                    <div class="profile-avatar">üë§</div>
                    <div class="profile-info">
                        <h2 id="civWelcomeName">Welcome</h2>
                        <p id="civWelcomeInfo">Civilian Portal Access</p>
                    </div>
                </div>

                <div id="civAlerts"></div>

                <div class="grid">
                    <div class="card civilian-theme">
                        <h3>Quick Stats</h3>
                        <div id="civQuickStats">
                            <p>üìù Citations: <strong id="civStatCitations">0</strong></p>
                            <p>üöó Vehicles: <strong id="civStatVehicles">0</strong></p>
                            <p>‚öñÔ∏è Warrants: <strong id="civStatWarrants">0</strong></p>
                        </div>
                    </div>
                    <div class="card civilian-theme">
                        <h3>Recent Activity</h3>
                        <div id="civRecentActivity">
                            <div class="empty-state">No recent activity</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Civilian Profile Tab -->
            <div id="civProfile" class="tab-content">
                <div class="card civilian-theme">
                    <h3>Personal Information</h3>
                    <div id="civProfileInfo"></div>
                    <button class="btn btn-warning" style="margin-top: 15px; width: auto;" onclick="openModal('editCivilian')">Edit Profile</button>
                </div>
            </div>

            <!-- Civilian Vehicles Tab -->
            <div id="civVehicles" class="tab-content">
                <div class="card civilian-theme">
                    <h3>üöó My Vehicles</h3>
                    <button class="btn btn-success" onclick="openModal('registerVehicle')">Register New Vehicle</button>
                    <div id="civVehiclesList" style="margin-top: 20px;"></div>
                </div>
            </div>

            <!-- Civilian Records Tab -->
            <div id="civRecords" class="tab-content">
                <div class="card civilian-theme">
                    <h3>üìã My Records</h3>
                    
                    <h4 style="margin-top: 20px; color: #667eea;">Citations</h4>
                    <div id="civCitationsList"></div>

                    <h4 style="margin-top: 20px; color: #667eea;">Warrants</h4>
                    <div id="civWarrantsList"></div>
                </div>
            </div>

            <!-- Civilian Services Tab -->
            <div id="civServices" class="tab-content">
                <div class="card civilian-theme">
                    <h3>üö® Emergency Services</h3>
                    
                    <div class="grid">
                        <div class="service-card" onclick="openModal('call911')">
                            <div class="icon">üö®</div>
                            <h4>Call 911</h4>
                            <p>Police Emergency</p>
                        </div>
                        <div class="service-card" onclick="openModal('callFire')">
                            <div class="icon">üöí</div>
                            <h4>Fire Department</h4>
                            <p>Fire & Rescue</p>
                        </div>
                        <div class="service-card" onclick="openModal('callEMS')">
                            <div class="icon">üöë</div>
                            <h4>EMS</h4>
                            <p>Medical Emergency</p>
                        </div>
                        <div class="service-card" onclick="openModal('nonEmergency')">
                            <div class="icon">üìû</div>
                            <h4>Non-Emergency</h4>
                            <p>Report Issues</p>
                        </div>
                    </div>
                </div>

                <div class="card civilian-theme">
                    <h3>üìû My Service Requests</h3>
                    <div id="civServiceRequests"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    
    <!-- Civilian Registration Modal -->
    <div id="civilianRegisterModal" class="modal">
        <div class="modal-content">
            <h3>Register Civilian Account</h3>
            <form id="civilianRegisterForm">
                <div class="form-group">
                    <label>First Name</label>
                    <input type="text" id="regFirstName" required>
                </div>
                <div class="form-group">
                    <label>Last Name</label>
                    <input type="text" id="regLastName" required>
                </div>
                <div class="form-group">
                    <label>Date of Birth</label>
                    <input type="date" id="regDOB" required>
                </div>
                <div class="form-group">
                    <label>Gender</label>
                    <select id="regGender" required>
                        <option value="Male">Male</option>
                        <option value="Female">Female</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Address</label>
                    <input type="text" id="regAddress" required>
                </div>
                <div class="form-group">
                    <label>Phone Number</label>
                    <input type="tel" id="regPhone" required>
                </div>
                <button type="submit" class="btn btn-success">Register</button>
                <button type="button" class="btn btn-secondary" onclick="closeModal('civilianRegister')">Cancel</button>
            </form>
        </div>
    </div>

    <!-- Call 911 Modal -->
    <div id="call911Modal" class="modal">
        <div class="modal-content">
            <h3>üö® Call 911</h3>
            <div class="alert alert-danger">
                <strong>EMERGENCY ONLY</strong> - This will dispatch police to your location
            </div>
            <form id="call911Form">
                <div class="form-group">
                    <label>Emergency Type</label>
                    <select id="emergencyType" required>
                        <option value="Robbery in Progress">Robbery in Progress</option>
                        <option value="Assault">Assault</option>
                        <option value="Burglary">Burglary</option>
                        <option value="Domestic Violence">Domestic Violence</option>
                        <option value="Suspicious Activity">Suspicious Activity</option>
                        <option value="Other Emergency">Other Emergency</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Your Location</label>
                    <input type="text" id="emergency911Location" required placeholder="Enter your current location">
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea id="emergency911Description" rows="3" required placeholder="Describe the emergency..."></textarea>
                </div>
                <button type="submit" class="btn btn-danger">Send Emergency Call</button>
                <button type="button" class="btn btn-secondary" onclick="closeModal('call911')">Cancel</button>
            </form>
        </div>
    </div>

    <!-- Call Fire Modal -->
    <div id="callFireModal" class="modal">
        <div class="modal-content">
            <h3>üöí Fire Department</h3>
            <form id="callFireForm">
                <div class="form-group">
                    <label>Emergency Type</label>
                    <select id="fireType" required>
                        <option value="Structure Fire">Structure Fire</option>
                        <option value="Vehicle Fire">Vehicle Fire</option>
                        <option value="Wildfire">Wildfire</option>
                        <option value="Gas Leak">Gas Leak</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Location</label>
                    <input type="text" id="fireLocation" required>
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea id="fireDescription" rows="3" required></textarea>
                </div>
                <button type="submit" class="btn btn-danger">Request Fire Department</button>
                <button type="button" class="btn btn-secondary" onclick="closeModal('callFire')">Cancel</button>
            </form>
        </div>
    </div>

    <!-- Call EMS Modal -->
    <div id="callEMSModal" class="modal">
        <div class="modal-content">
            <h3>üöë Emergency Medical Services</h3>
            <form id="callEMSForm">
                <div class="form-group">
                    <label>Medical Emergency Type</label>
                    <select id="emsType" required>
                        <option value="Injury">Injury</option>
                        <option value="Cardiac Event">Cardiac Event</option>
                        <option value="Breathing Problem">Breathing Problem</option>
                        <option value="Unconscious Person">Unconscious Person</option>
                        <option value="Overdose">Overdose</option>
                        <option value="Other Medical">Other Medical</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Location</label>
                    <input type="text" id="emsLocation" required>
                </div>
                <div class="form-group">
                    <label>Patient Condition</label>
                    <textarea id="emsDescription" rows="3" required placeholder="Describe the patient's condition..."></textarea>
                </div>
                <button type="submit" class="btn btn-danger">Request EMS</button>
                <button type="button" class="btn btn-secondary" onclick="closeModal('callEMS')">Cancel</button>
            </form>
        </div>
    </div>

    <!-- Non-Emergency Modal -->
    <div id="nonEmergencyModal" class="modal">
        <div class="modal-content">
            <h3>üìû Non-Emergency Report</h3>
            <form id="nonEmergencyForm">
                <div class="form-group">
                    <label>Report Type</label>
                    <select id="nonEmergencyType" required>
                        <option value="Noise Complaint">Noise Complaint</option>
                        <option value="Parking Violation">Parking Violation</option>
                        <option value="Property Damage">Property Damage</option>
                        <option value="Lost Property">Lost Property</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Location</label>
                    <input type="text" id="nonEmergencyLocation" required>
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea id="nonEmergencyDescription" rows="3" required></textarea>
                </div>
                <button type="submit" class="btn btn-success">Submit Report</button>
                <button type="button" class="btn btn-secondary" onclick="closeModal('nonEmergency')">Cancel</button>
            </form>
        </div>
    </div>

    <!-- Register Vehicle Modal -->
    <div id="registerVehicleModal" class="modal">
        <div class="modal-content">
            <h3>Register New Vehicle</h3>
            <form id="registerVehicleForm">
                <div class="form-group">
                    <label>License Plate</label>
                    <input type="text" id="regVehPlate" required style="text-transform: uppercase;">
                </div>
                <div class="form-group">
                    <label>Make</label>
                    <input type="text" id="regVehMake" required placeholder="e.g., Vapid">
                </div>
                <div class="form-group">
                    <label>Model</label>
                    <input type="text" id="regVehModel" required placeholder="e.g., Dominator">
                </div>
                <div class="form-group">
                    <label>Color</label>
                    <input type="text" id="regVehColor" required>
                </div>
                <div class="form-group">
                    <label>Year</label>
                    <input type="number" id="regVehYear" min="1900" max="2024" required>
                </div>
                <button type="submit" class="btn btn-success">Register Vehicle</button>
                <button type="button" class="btn btn-secondary" onclick="closeModal('registerVehicle')">Cancel</button>
            </form>
        </div>
    </div>

    <!-- Edit Civilian Modal -->
    <div id="editCivilianModal" class="modal">
        <div class="modal-content">
            <h3>Edit Profile</h3>
            <form id="editCivilianForm">
                <div class="form-group">
                    <label>Address</label>
                    <input type="text" id="editAddress" required>
                </div>
                <div class="form-group">
                    <label>Phone Number</label>
                    <input type="tel" id="editPhone" required>
                </div>
                <button type="submit" class="btn btn-success">Save Changes</button>
                <button type="button" class="btn btn-secondary" onclick="closeModal('editCivilian')">Cancel</button>
            </form>
        </div>
    </div>

    <!-- LEO Modals (same as before) -->
    <div id="newCallModal" class="modal">
        <div class="modal-content">
            <h3>Create New Call</h3>
            <form id="newCallForm">
                <div class="form-group">
                    <label>Call Type</label>
                    <select id="callType" required>
                        <option value="Traffic Stop">Traffic Stop</option>
                        <option value="Robbery">Robbery</option>
                        <option value="Assault">Assault</option>
                        <option value="Burglary">Burglary</option>
                        <option value="Medical">Medical Emergency</option>
                        <option value="Fire">Fire</option>
                        <option value="Welfare Check">Welfare Check</option>
                        <option value="Suspicious Activity">Suspicious Activity</option>
                        <option value="Domestic Disturbance">Domestic Disturbance</option>
                        <option value="Vehicle Pursuit">Vehicle Pursuit</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Priority</label>
                    <select id="callPriority" required>
                        <option value="high">High</option>
                        <option value="medium">Medium</option>
                        <option value="low">Low</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Location</label>
                    <input type="text" id="callLocation" required placeholder="e.g., Legion Square">
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea id="callDescription" rows="3" required placeholder="Call details..."></textarea>
                </div>
                <button type="submit" class="btn btn-success">Create Call</button>
                <button type="button" class="btn btn-secondary" onclick="closeModal('newCall')">Cancel</button>
            </form>
        </div>
    </div>

    <div id="newBoloModal" class="modal">
        <div class="modal-content">
            <h3>Create BOLO</h3>
            <form id="newBoloForm">
                <div class="form-group">
                    <label>BOLO Type</label>
                    <select id="boloType" required>
                        <option value="Person">Person</option>
                        <option value="Vehicle">Vehicle</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea id="boloDescription" rows="3" required placeholder="Detailed description..."></textarea>
                </div>
                <div class="form-group">
                    <label>Last Known Location</label>
                    <input type="text" id="boloLocation" required>
                </div>
                <button type="submit" class="btn btn-success">Create BOLO</button>
                <button type="button" class="btn btn-secondary" onclick="closeModal('newBolo')">Cancel</button>
            </form>
        </div>
    </div>

    <div id="addCivilianModal" class="modal">
        <div class="modal-content">
            <h3>Add Civilian Record</h3>
            <form id="addCivilianForm">
                <div class="form-group">
                    <label>First Name</label>
                    <input type="text" id="civFirstName" required>
                </div>
                <div class="form-group">
                    <label>Last Name</label>
                    <input type="text" id="civLastName" required>
                </div>
                <div class="form-group">
                    <label>Date of Birth</label>
                    <input type="date" id="civDOB" required>
                </div>
                <div class="form-group">
                    <label>Gender</label>
                    <select id="civGender" required>
                        <option value="Male">Male</option>
                        <option value="Female">Female</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Address</label>
                    <input type="text" id="civAddress" required>
                </div>
                <div class="form-group">
                    <label>Phone Number</label>
                    <input type="tel" id="civPhone">
                </div>
                <div class="form-group">
                    <label>Driver's License Status</label>
                    <select id="civLicense">
                        <option value="Valid">Valid</option>
                        <option value="Suspended">Suspended</option>
                        <option value="Revoked">Revoked</option>
                        <option value="None">None</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-success">Add Civilian</button>
                <button type="button" class="btn btn-secondary" onclick="closeModal('addCivilian')">Cancel</button>
            </form>
        </div>
    </div>

    <div id="addVehicleModal" class="modal">
        <div class="modal-content">
            <h3>Add Vehicle Record</h3>
            <form id="addVehicleForm">
                <div class="form-group">
                    <label>License Plate</label>
                    <input type="text" id="vehPlate" required style="text-transform: uppercase;">
                </div>
                <div class="form-group">
                    <label>Owner Name</label>
                    <input type="text" id="vehOwner" required>
                </div>
                <div class="form-group">
                    <label>Make</label>
                    <input type="text" id="vehMake" required placeholder="e.g., Vapid">
                </div>
                <div class="form-group">
                    <label>Model</label>
                    <input type="text" id="vehModel" required placeholder="e.g., Dominator">
                </div>
                <div class="form-group">
                    <label>Color</label>
                    <input type="text" id="vehColor" required>
                </div>
                <div class="form-group">
                    <label>Year</label>
                    <input type="number" id="vehYear" min="1900" max="2024">
                </div>
                <div class="form-group">
                    <label>Status</label>
                    <select id="vehStatus">
                        <option value="Valid">Valid</option>
                        <option value="Stolen">Stolen</option>
                        <option value="Wanted">Wanted</option>
                        <option value="Expired Registration">Expired Registration</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-success">Add Vehicle</button>
                <button type="button" class="btn btn-secondary" onclick="closeModal('addVehicle')">Cancel</button>
            </form>
        </div>
    </div>

    <div id="addWarrantModal" class="modal">
        <div class="modal-content">
            <h3>Add Warrant</h3>
            <form id="addWarrantForm">
                <div class="form-group">
                    <label>Person Name</label>
                    <input type="text" id="warrantName" required>
                </div>
                <div class="form-group">
                    <label>Warrant Type</label>
                    <select id="warrantType" required>
                        <option value="Arrest">Arrest Warrant</option>
                        <option value="Search">Search Warrant</option>
                        <option value="Bench">Bench Warrant</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Charges</label>
                    <textarea id="warrantCharges" rows="2" required></textarea>
                </div>
                <div class="form-group">
                    <label>Issued By</label>
                    <input type="text" id="warrantIssuedBy" required>
                </div>
                <div class="form-group">
                    <label>Issue Date</label>
                    <input type="date" id="warrantDate" required>
                </div>
                <button type="submit" class="btn btn-success">Add Warrant</button>
                <button type="button" class="btn btn-secondary" onclick="closeModal('addWarrant')">Cancel</button>
            </form>
        </div>
    </div>

    <div id="addCitationModal" class="modal">
        <div class="modal-content">
            <h3>Add Citation</h3>
            <form id="addCitationForm">
                <div class="form-group">
                    <label>Person Name</label>
                    <input type="text" id="citationName" required>
                </div>
                <div class="form-group">
                    <label>Citation Type</label>
                    <select id="citationType" required>
                        <option value="Traffic">Traffic Violation</option>
                        <option value="Parking">Parking Violation</option>
                        <option value="Municipal">Municipal Code Violation</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Violation</label>
                    <input type="text" id="citationViolation" required placeholder="e.g., Speeding 65 in 45">
                </div>
                <div class="form-group">
                    <label>Fine Amount ($)</label>
                    <input type="number" id="citationFine" required min="0">
                </div>
                <div class="form-group">
                    <label>Location</label>
                    <input type="text" id="citationLocation" required>
                </div>
                <div class="form-group">
                    <label>Issued By</label>
                    <input type="text" id="citationOfficer" required>
                </div>
                <div class="form-group">
                    <label>Status</label>
                    <select id="citationStatus">
                        <option value="Pending">Pending</option>
                        <option value="Paid">Paid</option>
                        <option value="Overdue">Overdue</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-success">Add Citation</button>
                <button type="button" class="btn btn-secondary" onclick="closeModal('addCitation')">Cancel</button>
            </form>
        </div>
    </div>

    <div id="addWeaponModal" class="modal">
        <div class="modal-content">
            <h3>Add Weapon Record</h3>
            <form id="addWeaponForm">
                <div class="form-group">
                    <label>Serial Number</label>
                    <input type="text" id="weaponSerial" required>
                </div>
                <div class="form-group">
                    <label>Type</label>
                    <select id="weaponType" required>
                        <option value="Pistol">Pistol</option>
                        <option value="Rifle">Rifle</option>
                        <option value="Shotgun">Shotgun</option>
                        <option value="SMG">SMG</option>
                        <option value="Assault Rifle">Assault Rifle</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Make/Model</label>
                    <input type="text" id="weaponModel" required>
                </div>
                <div class="form-group">
                    <label>Registered Owner</label>
                    <input type="text" id="weaponOwner">
                </div>
                <div class="form-group">
                    <label>Status</label>
                    <select id="weaponStatus">
                        <option value="Registered">Registered</option>
                        <option value="Stolen">Stolen</option>
                        <option value="Evidence">Evidence</option>
                        <option value="Unregistered">Unregistered</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-success">Add Weapon</button>
                <button type="button" class="btn btn-secondary" onclick="closeModal('addWeapon')">Cancel</button>
            </form>
        </div>
    </div>

    <div id="addPropertyModal" class="modal">
        <div class="modal-content">
            <h3>Add Property Record</h3>
            <form id="addPropertyForm">
                <div class="form-group">
                    <label>Address</label>
                    <input type="text" id="propAddress" required>
                </div>
                <div class="form-group">
                    <label>Owner Name</label>
                    <input type="text" id="propOwner" required>
                </div>
                <div class="form-group">
                    <label>Property Type</label>
                    <select id="propType" required>
                        <option value="Residential">Residential</option>
                        <option value="Commercial">Commercial</option>
                        <option value="Industrial">Industrial</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Notes</label>
                    <textarea id="propNotes" rows="3"></textarea>
                </div>
                <button type="submit" class="btn btn-success">Add Property</button>
                <button type="button" class="btn btn-secondary" onclick="closeModal('addProperty')">Cancel</button>
            </form>
        </div>
    </div>

    <script>
        // Database Class
        class Database {
            constructor() {
                this.civilians = this.loadData('civilians') || [];
                this.vehicles = this.loadData('vehicles') || [];
                this.warrants = this.loadData('warrants') || [];
                this.citations = this.loadData('citations') || [];
                this.weapons = this.loadData('weapons') || [];
                this.properties = this.loadData('properties') || [];
                this.serviceRequests = this.loadData('serviceRequests') || [];
                
                if (this.civilians.length === 0) {
                    this.initializeSampleData();
                }
            }

            loadData(key) {
                const data = localStorage.getItem('txrp_' + key);
                return data ? JSON.parse(data) : null;
            }

            saveData(key, data) {
                localStorage.setItem('txrp_' + key, JSON.stringify(data));
            }

            initializeSampleData() {
                this.civilians = [
                    { id: 1, firstName: "John", lastName: "Doe", dob: "1985-01-15", gender: "Male", address: "123 Grove Street", phone: "555-0101", license: "Valid" },
                    { id: 2, firstName: "Jane", lastName: "Smith", dob: "1990-03-22", gender: "Female", address: "456 Vinewood Blvd", phone: "555-0102", license: "Suspended" },
                    { id: 3, firstName: "Mike", lastName: "Johnson", dob: "1982-07-08", gender: "Male", address: "789 Del Perro", phone: "555-0103", license: "Valid" }
                ];

                this.vehicles = [
                    { id: 1, plate: "ABC123", owner: "John Doe", make: "Vapid", model: "Dominator", color: "Black", year: 2020, status: "Valid" },
                    { id: 2, plate: "XYZ789", owner: "Jane Smith", make: "Benefactor", model: "Schlagen", color: "Red", year: 2019, status: "Stolen" },
                    { id: 3, plate: "DEF456", owner: "Mike Johnson", make: "Grotti", model: "Turismo", color: "Blue", year: 2021, status: "Valid" }
                ];

                this.warrants = [
                    { id: 1, name: "Jane Smith", type: "Arrest", charges: "Assault, Resisting Arrest", issuedBy: "Judge Thompson", date: "2024-01-15" }
                ];

                this.citations = [
                    { id: 1, name: "John Doe", type: "Traffic", violation: "Speeding 65 in 45", fine: 150, location: "Great Ocean Highway", officer: "1-Adam-12", date: new Date().toISOString().split('T')[0], status: "Pending" }
                ];

                this.weapons = [
                    { id: 1, serial: "WPN001234", type: "Pistol", model: "Colt 1911", owner: "John Doe", status: "Registered" }
                ];

                this.properties = [
                    { id: 1, address: "123 Grove Street", owner: "John Doe", type: "Residential", notes: "Green house with white fence" }
                ];

                this.saveAll();
            }

            saveAll() {
                this.saveData('civilians', this.civilians);
                this.saveData('vehicles', this.vehicles);
                this.saveData('warrants', this.warrants);
                this.saveData('citations', this.citations);
                this.saveData('weapons', this.weapons);
                this.saveData('properties', this.properties);
                this.saveData('serviceRequests', this.serviceRequests);
            }

            add(type, data) {
                const id = Date.now();
                const item = { id, ...data };
                this[type].push(item);
                this.saveData(type, this[type]);
                return item;
            }

            update(type, id, data) {
                const index = this[type].findIndex(item => item.id === id);
                if (index !== -1) {
                    this[type][index] = { ...this[type][index], ...data };
                    this.saveData(type, this[type]);
                    return this[type][index];
                }
                return null;
            }

            delete(type, id) {
                this[type] = this[type].filter(item => item.id !== id);
                this.saveData(type, this[type]);
            }

            search(type, query) {
                return this[type].filter(item => {
                    return Object.values(item).some(value => 
                        String(value).toLowerCase().includes(query.toLowerCase())
                    );
                });
            }

            findCivilian(firstName, lastName, dob) {
                return this.civilians.find(c => 
                    c.firstName.toLowerCase() === firstName.toLowerCase() &&
                    c.lastName.toLowerCase() === lastName.toLowerCase() &&
                    c.dob === dob
                );
            }

            exportData(type) {
                const data = JSON.stringify(this[type], null, 2);
                const blob = new Blob([data], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `txrp_${type}_${new Date().getTime()}.json`;
                a.click();
            }
        }

        // Initialize
        const db = new Database();
        let currentUser = null;
        let currentCivilian = null;
        let activeCalls = [];
        let activeUnits = [];
        let bolos = [];
        let loginType = 'leo';

        // Login Type Selection
        function selectLoginType(type) {
            loginType = type;
            document.querySelectorAll('.login-type-btn').forEach(btn => btn.classList.remove('active'));
            event.target.closest('.login-type-btn').classList.add('active');

            if (type === 'leo') {
                document.getElementById('leoLoginForm').style.display = 'block';
                document.getElementById('civilianLoginForm').style.display = 'none';
            } else {
                document.getElementById('leoLoginForm').style.display = 'none';
                document.getElementById('civilianLoginForm').style.display = 'block';
            }
        }

        // LEO Login
        document.getElementById('leoLoginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const callsign = document.getElementById('callsign').value;
            const department = document.getElementById('department').value;

            currentUser = { username, callsign, department, type: 'leo' };
            
            activeUnits.push({
                id: Date.now(),
                callsign: callsign,
                officer: username,
                department: department,
                status: 'available',
                assignedCall: null
            });

            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('leoDashboard').style.display = 'block';
            document.getElementById('userDisplay').textContent = `${callsign} - ${username} (${department})`;
            
            updateDashboard();
        });

        // Civilian Login
        document.getElementById('civilianLoginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const firstName = document.getElementById('civLoginFirstName').value;
            const lastName = document.getElementById('civLoginLastName').value;
            const dob = document.getElementById('civLoginDOB').value;

            const civilian = db.findCivilian(firstName, lastName, dob);
            
            if (civilian) {
                currentCivilian = civilian;
                currentUser = { ...civilian, type: 'civilian' };
                
                document.getElementById('loginPage').style.display = 'none';
                document.getElementById('civilianDashboard').style.display = 'block';
                
                updateCivilianDashboard();
            } else {
                alert('Civilian not found. Please check your information or register a new account.');
            }
        });

        // Civilian Registration
        document.getElementById('civilianRegisterForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const civilian = {
                firstName: document.getElementById('regFirstName').value,
                lastName: document.getElementById('regLastName').value,
                dob: document.getElementById('regDOB').value,
                gender: document.getElementById('regGender').value,
                address: document.getElementById('regAddress').value,
                phone: document.getElementById('regPhone').value,
                license: "Valid"
            };

            db.add('civilians', civilian);
            closeModal('civilianRegister');
            document.getElementById('civilianRegisterForm').reset();
            alert('Account registered successfully! You can now login.');
        });

        // Civilian Dashboard Functions
        function updateCivilianDashboard() {
            const fullName = `${currentCivilian.firstName} ${currentCivilian.lastName}`;
            document.getElementById('civilianUserDisplay').textContent = fullName;
            document.getElementById('civWelcomeName').textContent = `Welcome, ${fullName}`;
            document.getElementById('civWelcomeInfo').textContent = currentCivilian.address;

            // Update stats
            const myCitations = db.citations.filter(c => c.name.toLowerCase().includes(fullName.toLowerCase()));
            const myWarrants = db.warrants.filter(w => w.name.toLowerCase().includes(fullName.toLowerCase()));
            const myVehicles = db.vehicles.filter(v => v.owner.toLowerCase().includes(fullName.toLowerCase()));

            document.getElementById('civStatCitations').textContent = myCitations.length;
            document.getElementById('civStatWarrants').textContent = myWarrants.length;
            document.getElementById('civStatVehicles').textContent = myVehicles.length;

            // Show alerts
            updateCivAlerts(myWarrants, myCitations);

            // Update profile
            updateCivProfile();

            // Update vehicles list
            updateCivVehicles();

            // Update records
            updateCivRecords();

            // Update service requests
            updateCivServiceRequests();
        }

        function updateCivAlerts(warrants, citations) {
            const alertsDiv = document.getElementById('civAlerts');
            let html = '';

            if (warrants.length > 0) {
                html += `<div class="alert alert-danger">
                    <strong>‚ö†Ô∏è Active Warrant(s):</strong> You have ${warrants.length} active warrant(s). Please contact authorities.
                </div>`;
            }

            const unpaidCitations = citations.filter(c => c.status === 'Pending' || c.status === 'Overdue');
            if (unpaidCitations.length > 0) {
                const totalFines = unpaidCitations.reduce((sum, c) => sum + parseFloat(c.fine), 0);
                html += `<div class="alert alert-warning">
                    <strong>üìù Unpaid Citations:</strong> You have ${unpaidCitations.length} unpaid citation(s) totaling $${totalFines.toFixed(2)}
                </div>`;
            }

            if (html === '') {
                html = `<div class="alert alert-success">
                    <strong>‚úÖ All Clear:</strong> You have no active warrants or unpaid citations.
                </div>`;
            }

            alertsDiv.innerHTML = html;
        }

        function updateCivProfile() {
            const profileDiv = document.getElementById('civProfileInfo');
            profileDiv.innerHTML = `
                <div class="info-card civilian-theme">
                    <p><strong>Name:</strong> ${currentCivilian.firstName} ${currentCivilian.lastName}</p>
                    <p><strong>Date of Birth:</strong> ${currentCivilian.dob}</p>
                    <p><strong>Gender:</strong> ${currentCivilian.gender}</p>
                    <p><strong>Address:</strong> ${currentCivilian.address}</p>
                    <p><strong>Phone:</strong> ${currentCivilian.phone}</p>
                    <p><strong>License Status:</strong> <span class="badge ${currentCivilian.license === 'Valid' ? 'badge-success' : 'badge-danger'}">${currentCivilian.license}</span></p>
                </div>
            `;
        }

        function updateCivVehicles() {
            const fullName = `${currentCivilian.firstName} ${currentCivilian.lastName}`;
            const myVehicles = db.vehicles.filter(v => v.owner.toLowerCase().includes(fullName.toLowerCase()));
            const vehiclesDiv = document.getElementById('civVehiclesList');

            if (myVehicles.length === 0) {
                vehiclesDiv.innerHTML = '<div class="empty-state">No vehicles registered</div>';
                return;
            }

            vehiclesDiv.innerHTML = myVehicles.map(v => `
                <div class="info-card civilian-theme">
                    <h4>${v.make} ${v.model}</h4>
                    <p><strong>Plate:</strong> ${v.plate}</p>
                    <p><strong>Color:</strong> ${v.color}</p>
                    <p><strong>Year:</strong> ${v.year}</p>
                    <p><strong>Status:</strong> <span class="badge ${v.status === 'Valid' ? 'badge-success' : 'badge-danger'}">${v.status}</span></p>
                </div>
            `).join('');
        }

        function updateCivRecords() {
            const fullName = `${currentCivilian.firstName} ${currentCivilian.lastName}`;
            
            // Citations
            const myCitations = db.citations.filter(c => c.name.toLowerCase().includes(fullName.toLowerCase()));
            const citationsDiv = document.getElementById('civCitationsList');
            
            if (myCitations.length === 0) {
                citationsDiv.innerHTML = '<div class="empty-state">No citations on record</div>';
            } else {
                citationsDiv.innerHTML = myCitations.map(c => `
                    <div class="info-card civilian-theme">
                        <p><strong>Violation:</strong> ${c.violation}</p>
                        <p><strong>Fine:</strong> $${c.fine}</p>
                        <p><strong>Location:</strong> ${c.location}</p>
                        <p><strong>Date:</strong> ${c.date}</p>
                        <p><strong>Status:</strong> <span class="badge ${c.status === 'Paid' ? 'badge-success' : 'badge-warning'}">${c.status}</span></p>
                    </div>
                `).join('');
            }

            // Warrants
            const myWarrants = db.warrants.filter(w => w.name.toLowerCase().includes(fullName.toLowerCase()));
            const warrantsDiv = document.getElementById('civWarrantsList');
            
            if (myWarrants.length === 0) {
                warrantsDiv.innerHTML = '<div class="empty-state">No warrants on record</div>';
            } else {
                warrantsDiv.innerHTML = myWarrants.map(w => `
                    <div class="info-card civilian-theme" style="border-left-color: #dc3545;">
                        <p><strong>Type:</strong> ${w.type} Warrant</p>
                        <p><strong>Charges:</strong> ${w.charges}</p>
                        <p><strong>Issued:</strong> ${w.date}</p>
                        <p><strong>Issued By:</strong> ${w.issuedBy}</p>
                    </div>
                `).join('');
            }
        }

        function updateCivServiceRequests() {
            const fullName = `${currentCivilian.firstName} ${currentCivilian.lastName}`;
            const myRequests = db.serviceRequests.filter(r => r.civilianName === fullName);
            const requestsDiv = document.getElementById('civServiceRequests');

            if (myRequests.length === 0) {
                requestsDiv.innerHTML = '<div class="empty-state">No service requests</div>';
                return;
            }

            requestsDiv.innerHTML = myRequests.map(r => `
                <div class="info-card civilian-theme">
                    <h4>${r.type}</h4>
                    <p><strong>Location:</strong> ${r.location}</p>
                    <p><strong>Time:</strong> ${r.time} - ${r.date}</p>
                    <p><strong>Status:</strong> <span class="badge badge-info">${r.status || 'Dispatched'}</span></p>
                </div>
            `).join('');
        }

        // Service Request Forms
        document.getElementById('call911Form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const request = {
                civilianName: `${currentCivilian.firstName} ${currentCivilian.lastName}`,
                type: document.getElementById('emergencyType').value,
                location: document.getElementById('emergency911Location').value,
                description: document.getElementById('emergency911Description').value,
                time: new Date().toLocaleTimeString(),
                date: new Date().toLocaleDateString(),
                status: 'Dispatched',
                priority: 'high'
            };

            db.add('serviceRequests', request);
            
            // Also create a call in the LEO system
            activeCalls.push({
                id: Date.now(),
                type: request.type,
                priority: 'high',
                location: request.location,
                description: `Civilian Report - ${request.description}`,
                time: request.time,
                date: request.date,
                caller: request.civilianName,
                assignedUnits: []
            });

            closeModal('call911');
            document.getElementById('call911Form').reset();
            alert('Emergency services have been dispatched to your location!');
            updateCivServiceRequests();
        });

        document.getElementById('callFireForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const request = {
                civilianName: `${currentCivilian.firstName} ${currentCivilian.lastName}`,
                type: 'Fire - ' + document.getElementById('fireType').value,
                location: document.getElementById('fireLocation').value,
                description: document.getElementById('fireDescription').value,
                time: new Date().toLocaleTimeString(),
                date: new Date().toLocaleDateString(),
                status: 'Dispatched'
            };

            db.add('serviceRequests', request);
            
            activeCalls.push({
                id: Date.now(),
                type: request.type,
                priority: 'high',
                location: request.location,
                description: request.description,
                time: request.time,
                date: request.date,
                caller: request.civilianName,
                assignedUnits: []
            });

            closeModal('callFire');
            document.getElementById('callFireForm').reset();
            alert('Fire Department has been dispatched!');
            updateCivServiceRequests();
        });

        document.getElementById('callEMSForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const request = {
                civilianName: `${currentCivilian.firstName} ${currentCivilian.lastName}`,
                type: 'Medical - ' + document.getElementById('emsType').value,
                location: document.getElementById('emsLocation').value,
                description: document.getElementById('emsDescription').value,
                time: new Date().toLocaleTimeString(),
                date: new Date().toLocaleDateString(),
                status: 'Dispatched'
            };

            db.add('serviceRequests', request);
            
            activeCalls.push({
                id: Date.now(),
                type: request.type,
                priority: 'high',
                location: request.location,
                description: request.description,
                time: request.time,
                date: request.date,
                caller: request.civilianName,
                assignedUnits: []
            });

            closeModal('callEMS');
            document.getElementById('callEMSForm').reset();
            alert('EMS has been dispatched!');
            updateCivServiceRequests();
        });

        document.getElementById('nonEmergencyForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const request = {
                civilianName: `${currentCivilian.firstName} ${currentCivilian.lastName}`,
                type: document.getElementById('nonEmergencyType').value,
                location: document.getElementById('nonEmergencyLocation').value,
                description: document.getElementById('nonEmergencyDescription').value,
                time: new Date().toLocaleTimeString(),
                date: new Date().toLocaleDateString(),
                status: 'Pending'
            };

            db.add('serviceRequests', request);
            
            activeCalls.push({
                id: Date.now(),
                type: request.type,
                priority: 'low',
                location: request.location,
                description: request.description,
                time: request.time,
                date: request.date,
                caller: request.civilianName,
                assignedUnits: []
            });

            closeModal('nonEmergency');
            document.getElementById('nonEmergencyForm').reset();
            alert('Your report has been submitted!');
            updateCivServiceRequests();
        });

        // Register Vehicle
        document.getElementById('registerVehicleForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const vehicle = {
                plate: document.getElementById('regVehPlate').value.toUpperCase(),
                owner: `${currentCivilian.firstName} ${currentCivilian.lastName}`,
                make: document.getElementById('regVehMake').value,
                model: document.getElementById('regVehModel').value,
                color: document.getElementById('regVehColor').value,
                year: document.getElementById('regVehYear').value,
                status: 'Valid'
            };

            db.add('vehicles', vehicle);
            closeModal('registerVehicle');
            document.getElementById('registerVehicleForm').reset();
            alert('Vehicle registered successfully!');
            updateCivVehicles();
            updateCivilianDashboard();
        });

        // Edit Civilian Profile
        document.getElementById('editCivilianForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const updates = {
                address: document.getElementById('editAddress').value,
                phone: document.getElementById('editPhone').value
            };

            db.update('civilians', currentCivilian.id, updates);
            currentCivilian = { ...currentCivilian, ...updates };
            
            closeModal('editCivilian');
            alert('Profile updated successfully!');
            updateCivilianDashboard();
        });

        // Populate edit form
        function openEditCivilian() {
            document.getElementById('editAddress').value = currentCivilian.address;
            document.getElementById('editPhone').value = currentCivilian.phone;
            openModal('editCivilian');
        }

        // Tab Switching
        function switchTab(tabName) {
            document.querySelectorAll('#leoDashboard .tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('#leoDashboard .tab-navigation .tab-btn').forEach(btn => btn.classList.remove('active'));
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');

            if (tabName === 'database') {
                updateDatabaseTables();
            }
        }

        function switchCivTab(tabName) {
            document.querySelectorAll('#civilianDashboard .tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('#civilianDashboard .tab-navigation .tab-btn').forEach(btn => {
                btn.classList.remove('active');
                btn.classList.remove('civilian-theme');
            });
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active', 'civilian-theme');
        }

        function switchDbTab(tabName) {
            document.querySelectorAll('.db-tab').forEach(tab => tab.style.display = 'none');
            document.querySelectorAll('.card .tab-navigation .tab-btn').forEach(btn => btn.classList.remove('active'));
            
            document.getElementById('db-' + tabName).style.display = 'block';
            event.target.classList.add('active');
            
            updateDatabaseTables();
        }

        // Logout
        function logout() {
            if (currentUser.type === 'leo') {
                activeUnits = activeUnits.filter(u => u.callsign !== currentUser.callsign);
            }
            
            currentUser = null;
            currentCivilian = null;
            
            document.getElementById('loginPage').style.display = 'flex';
            document.getElementById('leoDashboard').style.display = 'none';
            document.getElementById('civilianDashboard').style.display = 'none';
            document.getElementById('leoLoginForm').reset();
            document.getElementById('civilianLoginForm').reset();
        }

        // Modal Management
        function openModal(modalType) {
            if (modalType === 'editCivilian') {
                openEditCivilian();
                return;
            }
            document.getElementById(modalType + 'Modal').classList.add('active');
        }

        function closeModal(modalType) {
            document.getElementById(modalType + 'Modal').classList.remove('active');
        }

        // LEO Form Handlers (same as before)
        document.getElementById('newCallForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const newCall = {
                id: Date.now(),
                type: document.getElementById('callType').value,
                priority: document.getElementById('callPriority').value,
                location: document.getElementById('callLocation').value,
                description: document.getElementById('callDescription').value,
                time: new Date().toLocaleTimeString(),
                date: new Date().toLocaleDateString(),
                assignedUnits: []
            };

            activeCalls.push(newCall);
            closeModal('newCall');
            document.getElementById('newCallForm').reset();
            updateDashboard();
        });

        document.getElementById('newBoloForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const newBolo = {
                id: Date.now(),
                type: document.getElementById('boloType').value,
                description: document.getElementById('boloDescription').value,
                location: document.getElementById('boloLocation').value,
                time: new Date().toLocaleTimeString(),
                date: new Date().toLocaleDateString(),
                createdBy: currentUser.callsign
            };

            bolos.push(newBolo);
            closeModal('newBolo');
            document.getElementById('newBoloForm').reset();
            updateDashboard();
        });

        document.getElementById('addCivilianForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const civilian = {
                firstName: document.getElementById('civFirstName').value,
                lastName: document.getElementById('civLastName').value,
                dob: document.getElementById('civDOB').value,
                gender: document.getElementById('civGender').value,
                address: document.getElementById('civAddress').value,
                phone: document.getElementById('civPhone').value,
                license: document.getElementById('civLicense').value
            };

            db.add('civilians', civilian);
            closeModal('addCivilian');
            document.getElementById('addCivilianForm').reset();
            updateDatabaseTables();
            updateDashboard();
        });

        document.getElementById('addVehicleForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const vehicle = {
                plate: document.getElementById('vehPlate').value.toUpperCase(),
                owner: document.getElementById('vehOwner').value,
                make: document.getElementById('vehMake').value,
                model: document.getElementById('vehModel').value,
                color: document.getElementById('vehColor').value,
                year: document.getElementById('vehYear').value,
                status: document.getElementById('vehStatus').value
            };

            db.add('vehicles', vehicle);
            closeModal('addVehicle');
            document.getElementById('addVehicleForm').reset();
            updateDatabaseTables();
            updateDashboard();
        });

        document.getElementById('addWarrantForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const warrant = {
                name: document.getElementById('warrantName').value,
                type: document.getElementById('warrantType').value,
                charges: document.getElementById('warrantCharges').value,
                issuedBy: document.getElementById('warrantIssuedBy').value,
                date: document.getElementById('warrantDate').value
            };

            db.add('warrants', warrant);
            closeModal('addWarrant');
            document.getElementById('addWarrantForm').reset();
            updateDatabaseTables();
        });

        document.getElementById('addCitationForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const citation = {
                name: document.getElementById('citationName').value,
                type: document.getElementById('citationType').value,
                violation: document.getElementById('citationViolation').value,
                fine: document.getElementById('citationFine').value,
                location: document.getElementById('citationLocation').value,
                officer: document.getElementById('citationOfficer').value,
                date: new Date().toISOString().split('T')[0],
                status: document.getElementById('citationStatus').value
            };

            db.add('citations', citation);
            closeModal('addCitation');
            document.getElementById('addCitationForm').reset();
            updateDatabaseTables();
        });

        document.getElementById('addWeaponForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const weapon = {
                serial: document.getElementById('weaponSerial').value,
                type: document.getElementById('weaponType').value,
                model: document.getElementById('weaponModel').value,
                owner: document.getElementById('weaponOwner').value,
                status: document.getElementById('weaponStatus').value
            };

            db.add('weapons', weapon);
            closeModal('addWeapon');
            document.getElementById('addWeaponForm').reset();
            updateDatabaseTables();
        });

        document.getElementById('addPropertyForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const property = {
                address: document.getElementById('propAddress').value,
                owner: document.getElementById('propOwner').value,
                type: document.getElementById('propType').value,
                notes: document.getElementById('propNotes').value
            };

            db.add('properties', property);
            closeModal('addProperty');
            document.getElementById('addPropertyForm').reset();
            updateDatabaseTables();
        });

        // Lookup Function
        function performLookup() {
            const searchType = document.getElementById('searchType').value;
            const query = document.getElementById('searchQuery').value;
            const resultsDiv = document.getElementById('searchResults');

            if (!query) {
                resultsDiv.innerHTML = '<div class="empty-state">Please enter a search query</div>';
                return;
            }

            let results = [];
            let html = '';

            if (searchType === 'person') {
                results = db.search('civilians', query);
                if (results.length > 0) {
                    results.forEach(person => {
                        const fullName = `${person.firstName} ${person.lastName}`;
                        const warrants = db.warrants.filter(w => w.name.toLowerCase().includes(fullName.toLowerCase()));
                        const citations = db.citations.filter(c => c.name.toLowerCase().includes(fullName.toLowerCase()));
                        
                        html += `
                            <div class="search-result">
                                <h4>${fullName}</h4>
                                <p><strong>DOB:</strong> ${person.dob}</p>
                                <p><strong>Gender:</strong> ${person.gender}</p>
                                <p><strong>Address:</strong> ${person.address}</p>
                                <p><strong>Phone:</strong> ${person.phone}</p>
                                <p><strong>License:</strong> <span class="badge ${person.license === 'Valid' ? 'badge-success' : 'badge-danger'}">${person.license}</span></p>
                                ${warrants.length > 0 ? `<p><strong>Warrants:</strong> <span class="badge badge-danger">${warrants.length} Active</span></p>` : '<p><strong>Warrants:</strong> None</p>'}
                                ${citations.length > 0 ? `<p><strong>Citations:</strong> ${citations.length} on record</p>` : ''}
                            </div>
                        `;
                    });
                }
            } else if (searchType === 'vehicle') {
                results = db.search('vehicles', query);
                if (results.length > 0) {
                    results.forEach(vehicle => {
                        html += `
                            <div class="search-result">
                                <h4>${vehicle.make} ${vehicle.model}</h4>
                                <p><strong>Plate:</strong> ${vehicle.plate}</p>
                                <p><strong>Owner:</strong> ${vehicle.owner}</p>
                                <p><strong>Color:</strong> ${vehicle.color}</p>
                                <p><strong>Year:</strong> ${vehicle.year}</p>
                                <p><strong>Status:</strong> <span class="badge ${vehicle.status === 'Valid' ? 'badge-success' : 'badge-danger'}">${vehicle.status}</span></p>
                            </div>
                        `;
                    });
                }
            } else if (searchType === 'weapon') {
                results = db.search('weapons', query);
                if (results.length > 0) {
                    results.forEach(weapon => {
                        html += `
                            <div class="search-result">
                                <h4>${weapon.type} - ${weapon.model}</h4>
                                <p><strong>Serial:</strong> ${weapon.serial}</p>
                                <p><strong>Owner:</strong> ${weapon.owner || 'Unknown'}</p>
                                <p><strong>Status:</strong> <span class="badge ${weapon.status === 'Registered' ? 'badge-success' : 'badge-danger'}">${weapon.status}</span></p>
                            </div>
                        `;
                    });
                }
            } else if (searchType === 'property') {
                results = db.search('properties', query);
                if (results.length > 0) {
                    results.forEach(property => {
                        html += `
                            <div class="search-result">
                                <h4>${property.address}</h4>
                                <p><strong>Owner:</strong> ${property.owner}</p>
                                <p><strong>Type:</strong> ${property.type}</p>
                                <p><strong>Notes:</strong> ${property.notes || 'None'}</p>
                            </div>
                        `;
                    });
                }
            }

            if (results.length === 0) {
                resultsDiv.innerHTML = '<div class="empty-state">No results found</div>';
            } else {
                resultsDiv.innerHTML = html;
            }
        }

        // Database Tables Update
        function updateDatabaseTables() {
            updateCiviliansTable();
            updateVehiclesTable();
            updateWarrantsTable();
            updateCitationsTable();
            updateWeaponsTable();
            updatePropertiesTable();
        }

        function updateCiviliansTable() {
            const container = document.getElementById('civiliansTable');
            if (db.civilians.length === 0) {
                container.innerHTML = '<div class="empty-state">No civilians in database</div>';
                return;
            }

            let html = '<table><thead><tr><th>Name</th><th>DOB</th><th>Gender</th><th>Address</th><th>License</th><th>Actions</th></tr></thead><tbody>';
            
            db.civilians.forEach(civ => {
                html += `
                    <tr>
                        <td>${civ.firstName} ${civ.lastName}</td>
                        <td>${civ.dob}</td>
                        <td>${civ.gender}</td>
                        <td>${civ.address}</td>
                        <td><span class="badge ${civ.license === 'Valid' ? 'badge-success' : 'badge-danger'}">${civ.license}</span></td>
                        <td>
                            <button class="btn btn-small btn-danger" onclick="deleteCivilian(${civ.id})">Delete</button>
                        </td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            container.innerHTML = html;
        }

        function updateVehiclesTable() {
            const container = document.getElementById('vehiclesTable');
            if (db.vehicles.length === 0) {
                container.innerHTML = '<div class="empty-state">No vehicles in database</div>';
                return;
            }

            let html = '<table><thead><tr><th>Plate</th><th>Vehicle</th><th>Owner</th><th>Color</th><th>Status</th><th>Actions</th></tr></thead><tbody>';
            
            db.vehicles.forEach(veh => {
                html += `
                    <tr>
                        <td><strong>${veh.plate}</strong></td>
                        <td>${veh.make} ${veh.model} (${veh.year})</td>
                        <td>${veh.owner}</td>
                        <td>${veh.color}</td>
                        <td><span class="badge ${veh.status === 'Valid' ? 'badge-success' : 'badge-danger'}">${veh.status}</span></td>
                        <td>
                            <button class="btn btn-small btn-danger" onclick="deleteVehicle(${veh.id})">Delete</button>
                        </td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            container.innerHTML = html;
        }

        function updateWarrantsTable() {
            const container = document.getElementById('warrantsTable');
            if (db.warrants.length === 0) {
                container.innerHTML = '<div class="empty-state">No warrants in database</div>';
                return;
            }

            let html = '<table><thead><tr><th>Name</th><th>Type</th><th>Charges</th><th>Issued By</th><th>Date</th><th>Actions</th></tr></thead><tbody>';
            
            db.warrants.forEach(warrant => {
                html += `
                    <tr>
                        <td><strong>${warrant.name}</strong></td>
                        <td>${warrant.type}</td>
                        <td>${warrant.charges}</td>
                        <td>${warrant.issuedBy}</td>
                        <td>${warrant.date}</td>
                        <td>
                            <button class="btn btn-small btn-danger" onclick="deleteWarrant(${warrant.id})">Delete</button>
                        </td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            container.innerHTML = html;
        }

        function updateCitationsTable() {
            const container = document.getElementById('citationsTable');
            if (db.citations.length === 0) {
                container.innerHTML = '<div class="empty-state">No citations in database</div>';
                return;
            }

            let html = '<table><thead><tr><th>Name</th><th>Type</th><th>Violation</th><th>Fine</th><th>Status</th><th>Officer</th><th>Actions</th></tr></thead><tbody>';
            
            db.citations.forEach(citation => {
                html += `
                    <tr>
                        <td>${citation.name}</td>
                        <td>${citation.type}</td>
                        <td>${citation.violation}</td>
                        <td>$${citation.fine}</td>
                        <td><span class="badge ${citation.status === 'Paid' ? 'badge-success' : 'badge-warning'}">${citation.status}</span></td>
                        <td>${citation.officer}</td>
                        <td>
                            <button class="btn btn-small btn-danger" onclick="deleteCitation(${citation.id})">Delete</button>
                        </td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            container.innerHTML = html;
        }

        function updateWeaponsTable() {
            const container = document.getElementById('weaponsTable');
            if (db.weapons.length === 0) {
                container.innerHTML = '<div class="empty-state">No weapons in database</div>';
                return;
            }

            let html = '<table><thead><tr><th>Serial</th><th>Type</th><th>Model</th><th>Owner</th><th>Status</th><th>Actions</th></tr></thead><tbody>';
            
            db.weapons.forEach(weapon => {
                html += `
                    <tr>
                        <td><strong>${weapon.serial}</strong></td>
                        <td>${weapon.type}</td>
                        <td>${weapon.model}</td>
                        <td>${weapon.owner || 'N/A'}</td>
                        <td><span class="badge ${weapon.status === 'Registered' ? 'badge-success' : 'badge-warning'}">${weapon.status}</span></td>
                        <td>
                            <button class="btn btn-small btn-danger" onclick="deleteWeapon(${weapon.id})">Delete</button>
                        </td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            container.innerHTML = html;
        }

        function updatePropertiesTable() {
            const container = document.getElementById('propertiesTable');
            if (db.properties.length === 0) {
                container.innerHTML = '<div class="empty-state">No properties in database</div>';
                return;
            }

            let html = '<table><thead><tr><th>Address</th><th>Owner</th><th>Type</th><th>Notes</th><th>Actions</th></tr></thead><tbody>';
            
            db.properties.forEach(property => {
                html += `
                    <tr>
                        <td><strong>${property.address}</strong></td>
                        <td>${property.owner}</td>
                        <td>${property.type}</td>
                        <td>${property.notes || 'N/A'}</td>
                        <td>
                            <button class="btn btn-small btn-danger" onclick="deleteProperty(${property.id})">Delete</button>
                        </td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            container.innerHTML = html;
        }

        // Delete Functions
        function deleteCivilian(id) {
            if (confirm('Are you sure you want to delete this civilian record?')) {
                db.delete('civilians', id);
                updateDatabaseTables();
                updateDashboard();
            }
        }

        function deleteVehicle(id) {
            if (confirm('Are you sure you want to delete this vehicle record?')) {
                db.delete('vehicles', id);
                updateDatabaseTables();
                updateDashboard();
            }
        }

        function deleteWarrant(id) {
            if (confirm('Are you sure you want to delete this warrant?')) {
                db.delete('warrants', id);
                updateDatabaseTables();
            }
        }

        function deleteCitation(id) {
            if (confirm('Are you sure you want to delete this citation?')) {
                db.delete('citations', id);
                updateDatabaseTables();
            }
        }

        function deleteWeapon(id) {
            if (confirm('Are you sure you want to delete this weapon record?')) {
                db.delete('weapons', id);
                updateDatabaseTables();
            }
        }

        function deleteProperty(id) {
            if (confirm('Are you sure you want to delete this property record?')) {
                db.delete('properties', id);
                updateDatabaseTables();
            }
        }

        function exportDatabase(type) {
            db.exportData(type);
        }

        // Update Dashboard
        function updateDashboard() {
            updateStats();
            updateCalls();
            updateUnits();
            updateBolos();
            updateOverview();
        }

        function updateStats() {
            document.getElementById('statCalls').textContent = activeCalls.length;
            document.getElementById('statUnits').textContent = activeUnits.length;
            document.getElementById('statCivilians').textContent = db.civilians.length;
            document.getElementById('statVehicles').textContent = db.vehicles.length;
        }

        function updateCalls() {
            const callsList = document.getElementById('callsList');
            
            if (activeCalls.length === 0) {
                callsList.innerHTML = '<div class="empty-state">No active calls</div>';
                return;
            }

            callsList.innerHTML = activeCalls.map(call => `
                <div class="call-item priority-${call.priority}">
                    <h4>${call.type} - ${call.location}</h4>
                    <p><strong>Priority:</strong> ${call.priority.toUpperCase()}</p>
                    <p><strong>Time:</strong> ${call.time} - ${call.date}</p>
                    <p><strong>Description:</strong> ${call.description}</p>
                    ${call.caller ? `<p><strong>Caller:</strong> ${call.caller}</p>` : ''}
                    <div class="action-buttons">
                        <button class="btn btn-small btn-danger" onclick="closeCall(${call.id})">Close Call</button>
                    </div>
                </div>
            `).join('');
        }

        function updateUnits() {
            const unitsList = document.getElementById('unitsList');
            
            if (activeUnits.length === 0) {
                unitsList.innerHTML = '<div class="empty-state">No units on duty</div>';
                return;
            }

            unitsList.innerHTML = activeUnits.map(unit => `
                <div class="unit-item">
                    <h4>${unit.callsign}</h4>
                    <p><strong>Officer:</strong> ${unit.officer}</p>
                    <p><strong>Department:</strong> ${unit.department}</p>
                    <span class="status status-${unit.status}">${unit.status.toUpperCase()}</span>
                </div>
            `).join('');
        }

        function updateBolos() {
            const boloList = document.getElementById('boloList');
            
            if (bolos.length === 0) {
                boloList.innerHTML = '<div class="empty-state">No active BOLOs</div>';
                return;
            }

            boloList.innerHTML = bolos.map(bolo => `
                <div class="bolo-item">
                    <h4>${bolo.type} BOLO</h4>
                    <p><strong>Description:</strong> ${bolo.description}</p>
                    <p><strong>Last Seen:</strong> ${bolo.location}</p>
                    <p><strong>Time:</strong> ${bolo.time} - ${bolo.date}</p>
                    <p><strong>Created By:</strong> ${bolo.createdBy}</p>
                    <div class="action-buttons">
                        <button class="btn btn-small btn-danger" onclick="removeBolo(${bolo.id})">Remove</button>
                    </div>
                </div>
            `).join('');
        }

        function updateOverview() {
            const overviewCalls = document.getElementById('overviewCalls');
            const overviewBolos = document.getElementById('overviewBolos');

            if (activeCalls.length === 0) {
                overviewCalls.innerHTML = '<div class="empty-state">No active calls</div>';
            } else {
                overviewCalls.innerHTML = activeCalls.slice(0, 3).map(call => `
                    <div class="db-record">
                        <h4>${call.type}</h4>
                        <p>${call.location} - ${call.time}</p>
                    </div>
                `).join('');
            }

            if (bolos.length === 0) {
                overviewBolos.innerHTML = '<div class="empty-state">No active BOLOs</div>';
            } else {
                overviewBolos.innerHTML = bolos.slice(0, 3).map(bolo => `
                    <div class="db-record">
                        <h4>${bolo.type} BOLO</h4>
                        <p>${bolo.description.substring(0, 50)}...</p>
                    </div>
                `).join('');
            }
        }

        function closeCall(callId) {
            activeCalls = activeCalls.filter(c => c.id !== callId);
            updateDashboard();
        }

        function removeBolo(boloId) {
            bolos = bolos.filter(b => b.id !== boloId);
            updateDashboard();
        }

        // Close modals when clicking outside
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.classList.remove('active');
            }
        }
    </script>
</body>
</html>